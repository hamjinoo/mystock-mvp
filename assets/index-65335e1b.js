import{j as t,r as e,H as o,C as a,P as s,D as r,b as i,c as n,a as c}from"./react-265ec861.js";import{L as l,B as d}from"./router-a48e489e.js";import{D as m}from"./dexie-e331f4d1.js";import{g as u,h as p,i as h}from"./vendor-936e0d4d.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const o of t)if("childList"===o.type)for(const t of o.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();const f={},y=function(t,e,o){if(!e||0===e.length)return t();const a=document.getElementsByTagName("link");return Promise.all(e.map((t=>{if((t=function(t){return"/jinwoo/"+t}(t))in f)return;f[t]=!0;const e=t.endsWith(".css"),s=e?'[rel="stylesheet"]':"";if(!!o)for(let o=a.length-1;o>=0;o--){const s=a[o];if(s.href===t&&(!e||"stylesheet"===s.rel))return}else if(document.querySelector(`link[href="${t}"]${s}`))return;const r=document.createElement("link");return r.rel=e?"stylesheet":"modulepreload",e||(r.as="script",r.crossOrigin=""),r.href=t,document.head.appendChild(r),e?new Promise(((e,o)=>{r.addEventListener("load",e),r.addEventListener("error",(()=>o(new Error(`Unable to preload CSS for ${t}`))))})):void 0}))).then((()=>t())).catch((t=>{const e=new Event("vite:preloadError",{cancelable:!0});if(e.payload=t,window.dispatchEvent(e),!e.defaultPrevented)throw t}))},w=["#00C49F","#0088FE","#FFBB28","#FF8042","#8884D8","#82CA9D","#FF6B6B","#4ECDC4","#45B7D1","#96CEB4"],x={sm:"h-4 w-4",md:"h-8 w-8",lg:"h-12 w-12"},_=({message:e="로딩 중...",size:o="md",className:a=""})=>t.jsxs("div",{className:`flex flex-col justify-center items-center ${a}`,children:[t.jsx("div",{className:`animate-spin rounded-full border-b-2 border-gray-300 ${x[o]}`}),e&&t.jsx("p",{className:"text-gray-400 text-sm mt-2",children:e})]});const g=new class extends m{constructor(){super("MyStockDB"),this.version(1).stores({accounts:"++id, broker, accountNumber, currency",portfolios:"++id, accountId, name, currency",positions:"++id, portfolioId, symbol, strategyCategory",todos:"++id, portfolioId, completed, createdAt"}),this.version(7).upgrade((t=>t.table("todos").toCollection().modify((t=>{"portfolioGroupId"in t&&(t.portfolioId=t.portfolioGroupId,delete t.portfolioGroupId)})))),this.version(8).stores({accounts:"++id, broker, accountNumber, currency",portfolios:"++id, accountId, name, currency",positions:"++id, portfolioId, symbol, strategyCategory",todos:"++id, portfolioId, completed, createdAt",memos:"++id, title, content, createdAt, updatedAt"})}async getAccounts(){return await this.accounts.toArray()}async getAccountById(t){return await this.accounts.get(t)}async addAccount(t){const e={...t,createdAt:Date.now()};return await this.accounts.add(e)}async updateAccount(t,e){await this.accounts.update(t,e)}async deleteAccount(t){const e=(await this.portfolios.where("accountId").equals(t).toArray()).map((t=>t.id));await this.positions.where("portfolioId").anyOf(e).delete(),await this.portfolios.where("accountId").equals(t).delete(),await this.accounts.delete(t)}async addPortfolio(t){const e=(await this.portfolios.toArray()).length;return await this.portfolios.add({...t,order:e})}async addPosition(t){const e=await this.positions.where("portfolioId").equals(t.portfolioId).toArray(),o={...t,strategyCategory:t.strategyCategory||"UNCATEGORIZED",strategyTags:t.strategyTags||[],entryCount:t.entryCount||1,maxEntries:t.maxEntries||1,targetQuantity:t.targetQuantity||t.quantity,order:e.length};return await this.positions.add(o)}async addTodo(t){return await this.todos.add(t)}async addMemo(t){const e={...t,createdAt:Date.now(),updatedAt:Date.now()};return await this.memos.add(e)}async updatePortfolio(t){return await this.portfolios.update(t.id,t)}async updatePosition(t){const{id:e,...o}=t;return await this.positions.update(e,o)}async updateTodo(t){return await this.todos.update(t.id,t)}async updateMemo(t){return await this.memos.update(t.id,{...t,updatedAt:Date.now()})}async getPortfolioWithPositions(t){const e=await this.portfolios.get(t);if(!e)return null;const o=await this.positions.where("portfolioId").equals(t).toArray();return{...e,positions:o}}async exportData(){try{const[t,e,o,a,s]=await Promise.all([this.portfolios.toArray(),this.positions.toArray(),this.todos.toArray(),this.memos.toArray(),this.accounts.toArray()]);return{version:7,timestamp:Date.now(),data:{portfolios:t,positions:e,todos:o,memos:a,accounts:s}}}catch(t){throw t}}async importData(t){try{if(!t.data||!t.dbVersion)throw new Error("Invalid backup data format");return await this.transaction("rw",[this.portfolios,this.positions,this.todos,this.memos,this.accounts],(async()=>{await Promise.all([this.portfolios.clear(),this.positions.clear(),this.todos.clear(),this.memos.clear(),this.accounts.clear()]),await Promise.all([this.portfolios.bulkAdd(t.data.portfolios),this.positions.bulkAdd(t.data.positions),this.todos.bulkAdd(t.data.todos),this.memos.bulkAdd(t.data.memos),this.accounts.bulkAdd(t.data.accounts||[])])})),!0}catch(e){throw e}}async getMemos(){return await this.memos.orderBy("updatedAt").reverse().toArray()}async getMemoById(t){return await this.memos.get(t)}async deleteMemo(t){await this.memos.delete(t)}};g.on("ready",(()=>{})),g.open().catch((async t=>{"SchemaError"===t.name&&(await g.delete(),window.location.reload())}));const j=()=>{const t=(()=>{const t=localStorage.getItem("last_auto_backup_time");return t?parseInt(t):0})();return Date.now()-t>=864e5},A=async()=>{if(j())try{Date.now();const t=(new Date).toLocaleDateString("ko-KR");await E(`자동백업_${t}`),localStorage.setItem("last_auto_backup_time",Date.now().toString()),(()=>{const t=D().filter((t=>t.name.startsWith("자동백업_")));t.length>5&&t.sort(((t,e)=>e.timestamp-t.timestamp)).slice(5).forEach((t=>N(t.timestamp)))})()}catch(t){}},E=async t=>{try{g.isOpen()||await g.open();const[e,o,a,s,r]=await Promise.all([g.portfolios?.toArray()||[],g.positions?.toArray()||[],g.todos?.toArray()||[],g.memos?.toArray()||[],g.accounts?.toArray()||[]]),i={timestamp:Date.now(),name:t,dbVersion:g.verno,data:{portfolios:e,positions:o,todos:a,memos:s,accounts:r}};if(!P(i))throw new Error("백업 데이터 유효성 검사 실패");const n=D();return n.push({timestamp:i.timestamp,name:i.name}),localStorage.setItem("db_backups",JSON.stringify(n)),localStorage.setItem(`db_backup_${i.timestamp}`,JSON.stringify(i)),i}catch(e){throw new Error("백업 생성 중 오류가 발생했습니다.")}},P=t=>{try{if(!t.timestamp||!t.name||!t.data)return!1;if(!(Array.isArray(t.data.portfolios)&&Array.isArray(t.data.positions)&&Array.isArray(t.data.todos)&&Array.isArray(t.data.memos)&&Array.isArray(t.data.accounts)))return!1;const e=new Set(t.data.portfolios.map((t=>t.id)));return!!t.data.positions.every((t=>e.has(t.portfolioId)))}catch(e){return!1}},b=async t=>{try{const o=localStorage.getItem(`db_backup_${t}`);if(!o)throw new Error("백업을 찾을 수 없습니다.");const a=JSON.parse(o);if(!P(a))throw new Error("유효하지 않은 백업 데이터입니다.");a.dbVersion&&(a.dbVersion,g.verno);const s=await E(`복원_전_백업_${(new Date).toLocaleString("ko-KR")}`);try{await g.delete(),await g.open(),await Promise.all([g.portfolios?.bulkAdd(a.data.portfolios||[]),g.positions?.bulkAdd(a.data.positions||[]),g.todos?.bulkAdd(a.data.todos||[]),g.memos?.bulkAdd(a.data.memos||[]),g.accounts?.bulkAdd(a.data.accounts||[])].filter(Boolean))}catch(e){throw await I(s),new Error("백업 복원 실패. 이전 상태로 복구되었습니다.")}}catch(e){throw e}},I=async t=>{try{await g.delete(),await g.open(),await Promise.all([g.portfolios?.bulkAdd(t.data.portfolios||[]),g.positions?.bulkAdd(t.data.positions||[]),g.todos?.bulkAdd(t.data.todos||[]),g.memos?.bulkAdd(t.data.memos||[]),g.accounts?.bulkAdd(t.data.accounts||[])].filter(Boolean))}catch(e){throw new Error("임시 백업 복구 실패")}},D=()=>{const t=localStorage.getItem("db_backups");return t?JSON.parse(t):[]},N=t=>{const e=D().filter((e=>e.timestamp!==t));localStorage.setItem("db_backups",JSON.stringify(e)),localStorage.removeItem(`db_backup_${t}`)},k=e.lazy((()=>y((()=>import("./MainPage-5cc010e0.js")),["assets/MainPage-5cc010e0.js","assets/react-265ec861.js","assets/vendor-936e0d4d.js","assets/dexie-e331f4d1.js","assets/router-a48e489e.js","assets/portfolioService-3819a654.js"]).then((t=>({default:t.MainPage}))))),v=e.lazy((()=>y((()=>import("./PortfolioList-2772b6a7.js")),["assets/PortfolioList-2772b6a7.js","assets/react-265ec861.js","assets/vendor-936e0d4d.js","assets/dexie-e331f4d1.js","assets/router-a48e489e.js","assets/accountService-26154c96.js","assets/portfolioService-3819a654.js","assets/currencyUtils-b432909e.js"]).then((t=>({default:t.PortfolioList}))))),L=e.lazy((()=>y((()=>import("./NewPortfolio-67150978.js")),["assets/NewPortfolio-67150978.js","assets/react-265ec861.js","assets/vendor-936e0d4d.js","assets/dexie-e331f4d1.js","assets/accountService-26154c96.js","assets/portfolioService-3819a654.js","assets/router-a48e489e.js"]).then((t=>({default:t.NewPortfolioPage}))))),O=e.lazy((()=>y((()=>import("./PortfolioDetail-ac5c29be.js")),["assets/PortfolioDetail-ac5c29be.js","assets/react-265ec861.js","assets/vendor-936e0d4d.js","assets/dexie-e331f4d1.js","assets/router-a48e489e.js","assets/portfolioService-3819a654.js","assets/currencyUtils-b432909e.js"]).then((t=>({default:t.PortfolioDetail}))))),S=e.lazy((()=>y((()=>import("./PortfolioConfigPage-1ab0a8dc.js")),["assets/PortfolioConfigPage-1ab0a8dc.js","assets/react-265ec861.js","assets/vendor-936e0d4d.js","assets/dexie-e331f4d1.js","assets/portfolioService-3819a654.js","assets/router-a48e489e.js"]).then((t=>({default:t.PortfolioConfigPage}))))),T=e.lazy((()=>y((()=>import("./AccountList-d6950a09.js")),["assets/AccountList-d6950a09.js","assets/react-265ec861.js","assets/vendor-936e0d4d.js","assets/dexie-e331f4d1.js","assets/router-a48e489e.js","assets/accountService-26154c96.js"]).then((t=>({default:t.AccountList}))))),V=e.lazy((()=>y((()=>import("./NewAccount-75eeab74.js")),["assets/NewAccount-75eeab74.js","assets/react-265ec861.js","assets/vendor-936e0d4d.js","assets/dexie-e331f4d1.js","assets/accountService-26154c96.js","assets/router-a48e489e.js"]).then((t=>({default:t.NewAccount}))))),C=e.lazy((()=>y((()=>import("./AccountDetail-ff675771.js")),["assets/AccountDetail-ff675771.js","assets/react-265ec861.js","assets/vendor-936e0d4d.js","assets/dexie-e331f4d1.js","assets/router-a48e489e.js","assets/accountService-26154c96.js","assets/portfolioService-3819a654.js","assets/currencyUtils-b432909e.js"]).then((t=>({default:t.AccountDetailPage}))))),R=e.lazy((()=>y((()=>import("./EditAccount-2bbdcb7c.js")),["assets/EditAccount-2bbdcb7c.js","assets/react-265ec861.js","assets/vendor-936e0d4d.js","assets/dexie-e331f4d1.js","assets/accountService-26154c96.js","assets/router-a48e489e.js"]).then((t=>({default:t.EditAccountPage}))))),z=e.lazy((()=>y((()=>import("./NewPosition-520c2747.js")),["assets/NewPosition-520c2747.js","assets/react-265ec861.js","assets/vendor-936e0d4d.js","assets/dexie-e331f4d1.js","assets/CurrencyInput-1751f9bd.js","assets/currencyUtils-b432909e.js","assets/accountService-26154c96.js","assets/portfolioService-3819a654.js","assets/router-a48e489e.js"]).then((t=>({default:t.NewPositionPage}))))),B=e.lazy((()=>y((()=>import("./EditPosition-d472cc89.js")),["assets/EditPosition-d472cc89.js","assets/react-265ec861.js","assets/vendor-936e0d4d.js","assets/dexie-e331f4d1.js","assets/CurrencyInput-1751f9bd.js","assets/currencyUtils-b432909e.js","assets/accountService-26154c96.js","assets/portfolioService-3819a654.js","assets/router-a48e489e.js"]).then((t=>({default:t.EditPosition}))))),M=e.lazy((()=>y((()=>import("./ConsolidatedView-8ac6f59f.js")),["assets/ConsolidatedView-8ac6f59f.js","assets/react-265ec861.js","assets/vendor-936e0d4d.js","assets/dexie-e331f4d1.js","assets/accountService-26154c96.js","assets/portfolioService-3819a654.js","assets/currencyUtils-b432909e.js","assets/router-a48e489e.js"]).then((t=>({default:t.ConsolidatedView}))))),$=e.lazy((()=>y((()=>import("./MemoListPage-8a97ac51.js")),["assets/MemoListPage-8a97ac51.js","assets/react-265ec861.js","assets/vendor-936e0d4d.js","assets/dexie-e331f4d1.js","assets/router-a48e489e.js"]).then((t=>({default:t.MemoListPage}))))),F=e.lazy((()=>y((()=>import("./MemoDetailPage-fb23f0f7.js")),["assets/MemoDetailPage-fb23f0f7.js","assets/react-265ec861.js","assets/vendor-936e0d4d.js","assets/dexie-e331f4d1.js","assets/router-a48e489e.js"]).then((t=>({default:t.MemoDetailPage}))))),q=e.lazy((()=>y((()=>import("./SettingsPage-3b432d99.js")),["assets/SettingsPage-3b432d99.js","assets/react-265ec861.js","assets/vendor-936e0d4d.js","assets/dexie-e331f4d1.js","assets/router-a48e489e.js"]).then((t=>({default:t.SettingsPage}))))),J=e.lazy((()=>y((()=>import("./TodoPage-fd4c7450.js")),["assets/TodoPage-fd4c7450.js","assets/react-265ec861.js","assets/vendor-936e0d4d.js","assets/dexie-e331f4d1.js","assets/portfolioService-3819a654.js","assets/router-a48e489e.js"]).then((t=>({default:t.TodoPage}))))),G=()=>(e.useEffect((()=>{A();const t=setInterval((()=>{A()}),36e5);return()=>clearInterval(t)}),[]),t.jsx(e.Suspense,{fallback:t.jsx(_,{}),children:t.jsxs("div",{className:"min-h-screen bg-gray-900 text-white flex flex-col",children:[t.jsx("main",{className:"flex-1 pb-16",children:t.jsxs(u,{children:[t.jsx(p,{path:"/",element:t.jsx(k,{})}),t.jsx(p,{path:"/portfolios",element:t.jsx(v,{})}),t.jsx(p,{path:"/portfolios/new",element:t.jsx(L,{})}),t.jsx(p,{path:"/portfolios/:portfolioId",element:t.jsx(O,{})}),t.jsx(p,{path:"/portfolios/:portfolioId/config",element:t.jsx(S,{})}),t.jsx(p,{path:"/accounts",element:t.jsx(T,{})}),t.jsx(p,{path:"/accounts/new",element:t.jsx(V,{})}),t.jsx(p,{path:"/accounts/:accountId",element:t.jsx(C,{})}),t.jsx(p,{path:"/accounts/:accountId/edit",element:t.jsx(R,{})}),t.jsx(p,{path:"/accounts/:accountId/positions/new",element:t.jsx(z,{})}),t.jsx(p,{path:"/accounts/:accountId/positions/:positionId/edit",element:t.jsx(B,{})}),t.jsx(p,{path:"/consolidated",element:t.jsx(M,{})}),t.jsx(p,{path:"/memos",element:t.jsx($,{})}),t.jsx(p,{path:"/memos/:id",element:t.jsx(F,{})}),t.jsx(p,{path:"/settings",element:t.jsx(q,{})}),t.jsx(p,{path:"/todo",element:t.jsx(J,{})}),t.jsx(p,{path:"*",element:t.jsx(h,{to:"/",replace:!0})})]})}),t.jsx("nav",{className:"fixed bottom-0 left-0 right-0 bg-gray-800 border-t border-gray-700",children:t.jsx("div",{className:"max-w-md mx-auto px-4",children:t.jsxs("div",{className:"flex justify-around py-2",children:[t.jsxs(l,{to:"/",className:"flex flex-col items-center p-2 text-gray-400 hover:text-white",children:[t.jsx(o,{className:"h-6 w-6"}),t.jsx("span",{className:"text-xs mt-1",children:"홈"})]}),t.jsxs(l,{to:"/portfolios",className:"flex flex-col items-center p-2 text-gray-400 hover:text-white",children:[t.jsx(a,{className:"h-6 w-6"}),t.jsx("span",{className:"text-xs mt-1",children:"포트폴리오"})]}),t.jsxs(l,{to:"/consolidated",className:"flex flex-col items-center p-2 text-gray-400 hover:text-white",children:[t.jsx(s,{className:"h-6 w-6"}),t.jsx("span",{className:"text-xs mt-1",children:"전체보기"})]}),t.jsxs(l,{to:"/memos",className:"flex flex-col items-center p-2 text-gray-400 hover:text-white",children:[t.jsx(r,{className:"h-6 w-6"}),t.jsx("span",{className:"text-xs mt-1",children:"메모"})]}),t.jsxs(l,{to:"/settings",className:"flex flex-col items-center p-2 text-gray-400 hover:text-white",children:[t.jsx(i,{className:"h-6 w-6"}),t.jsx("span",{className:"text-xs mt-1",children:"설정"})]})]})})})]})}));n.createRoot(document.getElementById("root")).render(t.jsx(c.StrictMode,{children:t.jsx(d,{basename:"/jinwoo",children:t.jsx(G,{})})}));export{w as C,_ as L,N as a,E as c,g as d,D as g,b as r};
//# sourceMappingURL=index-65335e1b.js.map
