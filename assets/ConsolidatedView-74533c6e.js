import{j as e,L as s}from"./index-e48b942e.js";import{r as t}from"./react-2981e50d.js";import{A as a}from"./accountService-f5f42876.js";import{P as l}from"./portfolioService-309953aa.js";import{f as r}from"./currencyUtils-b432909e.js";import"./dexie-5294e5fd.js";const c=()=>{const[c,i]=t.useState([]),[n,d]=t.useState(!0),[o,x]=t.useState("value"),[m,u]=t.useState("desc");t.useEffect(()=>{h()},[]),t.useEffect(()=>{if(c.length>0){const e=[...c].sort((e,s)=>{let t=0;switch(o){case"symbol":t=e.symbol.localeCompare(s.symbol);break;case"value":t=e.totalValue-s.totalValue;break;case"return":t=e.returnRate-s.returnRate}return"asc"===m?t:-t});i(e)}},[o,m]);const h=async()=>{try{const[e,s]=await Promise.all([l.getAll(),a.getAll()]),t=[];for(const a of e){const e=await l.getWithPositions(a.id),r=s.find(e=>e.id===a.accountId);e.positions.forEach(e=>{t.push({...e,portfolioName:a.name,accountName:r?.accountName||"알 수 없음",currency:a.currency})})}const r=new Map;t.forEach(e=>{const s=e.symbol;r.has(s)||r.set(s,{symbol:e.symbol,name:e.name,totalQuantity:0,weightedAvgPrice:0,currentPrice:e.currentPrice,totalValue:0,totalCost:0,unrealizedPnL:0,returnRate:0,positions:[]});const t=r.get(s),a=e.quantity*e.avgPrice,l=e.quantity*e.currentPrice;t.totalCost+=a,t.totalQuantity+=e.quantity,t.weightedAvgPrice=t.totalCost/t.totalQuantity,t.totalValue+=l,t.currentPrice=e.currentPrice,t.unrealizedPnL=t.totalValue-t.totalCost,t.returnRate=t.totalCost>0?t.unrealizedPnL/t.totalCost*100:0,t.positions.push(e)});const c=Array.from(r.values()).sort((e,s)=>{let t=0;switch(o){case"symbol":t=e.symbol.localeCompare(s.symbol);break;case"value":t=e.totalValue-s.totalValue;break;case"return":t=e.returnRate-s.returnRate}return"asc"===m?t:-t});i(c)}catch(e){}finally{d(!1)}},g=e=>{o===e?u("asc"===m?"desc":"asc"):(x(e),u("desc"))},j=()=>c.reduce((e,s)=>e+s.totalValue,0),b=()=>c.reduce((e,s)=>e+s.unrealizedPnL,0),y=()=>{const e=c.reduce((e,s)=>e+s.totalCost,0),s=b();return e>0?s/e*100:0};return n?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(s,{})})}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-4",children:"전체 포지션 통합 보기"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-sm text-gray-400 mb-1",children:"총 포트폴리오 가치"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-400",children:["₩",r(j(),"KRW")]})]}),e.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-sm text-gray-400 mb-1",children:"총 평가손익"}),e.jsxs("p",{className:"text-2xl font-bold "+(b()>=0?"text-green-400":"text-red-400"),children:[b()>=0?"+":"","₩",r(Math.abs(b()),"KRW")]})]}),e.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-sm text-gray-400 mb-1",children:"총 수익률"}),e.jsxs("p",{className:"text-2xl font-bold "+(y()>=0?"text-green-400":"text-red-400"),children:[y()>=0?"+":"",y().toFixed(2),"%"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"자산 구성"}),0===c.length?e.jsx("div",{className:"text-center py-8 text-gray-400",children:"등록된 포지션이 없습니다."}):e.jsx("div",{className:"space-y-4",children:c.map((s,t)=>{const a=s.totalValue/j()*100,l=["bg-blue-500","bg-green-500","bg-yellow-500","bg-red-500","bg-purple-500","bg-pink-500","bg-indigo-500","bg-orange-500"],c=l[t%l.length];return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsx("div",{className:`w-4 h-4 rounded ${c} mr-3`}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"font-medium text-white",children:s.symbol}),e.jsxs("span",{className:"text-sm text-gray-400",children:[a.toFixed(1),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:`${c} h-2 rounded-full`,style:{width:`${a}%`}})})]})]}),e.jsxs("div",{className:"ml-4 text-right",children:[e.jsxs("div",{className:"text-sm font-medium",children:["₩",r(s.totalValue,"KRW")]}),e.jsxs("div",{className:"text-xs "+(s.returnRate>=0?"text-green-400":"text-red-400"),children:[s.returnRate>=0?"+":"",s.returnRate.toFixed(2),"%"]})]})]},s.symbol)})})]})}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"통합 포지션 목록"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>g("symbol"),className:"px-3 py-1 rounded text-xs "+("symbol"===o?"bg-blue-500 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"),children:["티커"," ","symbol"===o&&("asc"===m?"↑":"↓")]}),e.jsxs("button",{onClick:()=>g("value"),className:"px-3 py-1 rounded text-xs "+("value"===o?"bg-blue-500 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"),children:["금액 ","value"===o&&("asc"===m?"↑":"↓")]}),e.jsxs("button",{onClick:()=>g("return"),className:"px-3 py-1 rounded text-xs "+("return"===o?"bg-blue-500 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"),children:["수익률"," ","return"===o&&("asc"===m?"↑":"↓")]})]})]}),e.jsx("div",{className:"space-y-3",children:0===c.length?e.jsx("div",{className:"text-center py-8 text-gray-400",children:"등록된 포지션이 없습니다."}):c.map(s=>e.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:s.symbol}),e.jsx("p",{className:"text-sm text-gray-400",children:s.name})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-lg font-bold text-blue-400",children:["₩",r(s.totalValue,"KRW")]}),e.jsxs("p",{className:"text-sm font-semibold "+(s.returnRate>=0?"text-green-400":"text-red-400"),children:[s.returnRate>=0?"+":"",s.returnRate.toFixed(2),"%"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs text-gray-300 mb-3",children:[e.jsxs("div",{children:["수량: ",s.totalQuantity.toLocaleString(),"주"]}),e.jsxs("div",{children:["평균단가: ₩",r(s.weightedAvgPrice,"KRW")]}),e.jsxs("div",{children:["현재가: ₩",r(s.currentPrice,"KRW")]}),e.jsxs("div",{children:["투자금액: ₩",r(s.totalCost,"KRW")]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("h4",{className:"text-xs font-medium text-gray-400 mb-2",children:"포트폴리오별 분산"}),e.jsx("div",{className:"space-y-1",children:s.positions.map((t,a)=>{const l=t.quantity*t.currentPrice/s.totalValue*100;return e.jsxs("div",{className:"flex items-center text-xs",children:[e.jsx("div",{className:"w-20 text-gray-400 truncate",children:t.portfolioName}),e.jsx("div",{className:"flex-1 mx-2",children:e.jsx("div",{className:"w-full bg-gray-600 rounded-full h-1",children:e.jsx("div",{className:"bg-blue-400 h-1 rounded-full",style:{width:`${l}%`}})})}),e.jsxs("div",{className:"w-12 text-right text-gray-300",children:[l.toFixed(0),"%"]})]},a)})})]}),e.jsxs("details",{className:"text-xs",children:[e.jsxs("summary",{className:"cursor-pointer text-blue-400 hover:text-blue-300",children:["세부 포지션 (",s.positions.length,"개)"]}),e.jsx("div",{className:"mt-2 space-y-1",children:s.positions.map((s,t)=>e.jsxs("div",{className:"flex justify-between items-center py-1 px-2 bg-gray-600 rounded",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:s.portfolioName}),e.jsxs("span",{className:"text-gray-400 ml-1",children:["(",s.accountName,")"]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{children:[s.quantity,"주 × ₩",r(s.avgPrice,"KRW")]})})]},t))})]})]},s.symbol))})]})})]})]})};export{c as ConsolidatedView};
//# sourceMappingURL=ConsolidatedView-74533c6e.js.map
