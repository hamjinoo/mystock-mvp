import{j as e,d as t}from"./index-e48b942e.js";import{r as s}from"./react-2981e50d.js";import{A as a}from"./accountService-f5f42876.js";import{a as r,E as n,R as l}from"./riskManagementService-c38bc133.js";import{f as i}from"./currencyUtils-b432909e.js";import{S as c}from"./ShieldCheckIcon-3f143148.js";import{C as d}from"./CurrencyDollarIcon-1e6343ac.js";import{P as o}from"./portfolioService-309953aa.js";function m({title:e,titleId:t,...a},r){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},a),e?s.createElement("title",{id:t},e):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"}))}const x=s.forwardRef(m);function u({title:e,titleId:t,...a},r){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},a),e?s.createElement("title",{id:t},e):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z"}))}const h=s.forwardRef(u);function g({title:e,titleId:t,...a},r){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},a),e?s.createElement("title",{id:t},e):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 3v17.25m0 0c-1.472 0-2.882.265-4.185.75M12 20.25c1.472 0 2.882.265 4.185.75M18.75 4.97A48.416 48.416 0 0 0 12 4.5c-2.291 0-4.545.16-6.75.47m13.5 0c1.01.143 2.01.317 3 .52m-3-.52 2.62 10.726c.122.499-.106 1.028-.589 1.202a5.988 5.988 0 0 1-2.031.352 5.988 5.988 0 0 1-2.031-.352c-.483-.174-.711-.703-.59-1.202L18.75 4.971Zm-16.5.52c.99-.203 1.99-.377 3-.52m0 0 2.62 10.726c.122.499-.106 1.028-.589 1.202a5.989 5.989 0 0 1-2.031.352 5.989 5.989 0 0 1-2.031-.352c-.483-.174-.711-.703-.59-1.202L5.25 4.971Z"}))}const j=s.forwardRef(g);function b({title:e,titleId:t,...a},r){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},a),e?s.createElement("title",{id:t},e):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const p=s.forwardRef(b);function y({title:e,titleId:t,...a},r){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},a),e?s.createElement("title",{id:t},e):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18 18 6M6 6l12 12"}))}const w=s.forwardRef(y),N=({isOpen:t,onClose:a,onProceed:l,checklist:d,currency:o})=>{const[m,u]=s.useState(!1),[h,g]=s.useState("");if(!t||!d)return null;const j=()=>{d.canProceed?l():u(!0)},b=t=>{switch(t){case"PASS":return e.jsx(r,{className:"h-5 w-5 text-green-400"});case"WARNING":return e.jsx(x,{className:"h-5 w-5 text-yellow-400"});case"FAIL":return e.jsx(p,{className:"h-5 w-5 text-red-400"})}},y=e=>{switch(e){case"PASS":return"border-green-500/30 bg-green-900/10";case"WARNING":return"border-yellow-500/30 bg-yellow-900/10";case"FAIL":return"border-red-500/30 bg-red-900/10"}},N=t=>{switch(t){case"HIGH":return e.jsx(n,{className:"h-5 w-5 text-red-400"});case"MEDIUM":return e.jsx(x,{className:"h-5 w-5 text-yellow-400"});case"LOW":return e.jsx(x,{className:"h-5 w-5 text-blue-400"})}},f=d.checks.filter(e=>"PASS"===e.status).length,v=d.checks.length,E=d.checks.filter(e=>"WARNING"===e.status).length,k=d.checks.filter(e=>"FAIL"===e.status).length;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(c,{className:"h-6 w-6 mr-2 text-blue-400"}),e.jsx("h3",{className:"text-xl font-bold text-white",children:"íˆ¬ì ì „ ì•ˆì „ ì ê²€"})]}),e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-gray-300",children:e.jsx(w,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"bg-gray-700 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"ì¢…ëª©:"}),e.jsx("span",{className:"ml-2 font-medium text-white",children:d.symbol})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"íˆ¬ì ê¸ˆì•¡:"}),e.jsx("span",{className:"ml-2 font-medium text-white",children:i(d.plannedAmount,o)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"ì „ì²´ ìœ„í—˜ë„:"}),e.jsx("span",{className:`ml-2 px-2 py-1 rounded text-xs font-medium border ${(e=>{switch(e){case"HIGH":return"text-red-400 bg-red-900/20 border-red-500/30";case"MEDIUM":return"text-yellow-400 bg-yellow-900/20 border-yellow-500/30";case"LOW":return"text-green-400 bg-green-900/20 border-green-500/30"}})(d.overallRisk)}`,children:"HIGH"===d.overallRisk?"ë†’ìŒ":"MEDIUM"===d.overallRisk?"ë³´í†µ":"ë‚®ìŒ"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"ì§„í–‰ ê°€ëŠ¥:"}),e.jsx("span",{className:"ml-2 font-medium "+(d.canProceed?"text-green-400":"text-red-400"),children:d.canProceed?"ì˜ˆ":"ì•„ë‹ˆì˜¤"})]})]})}),e.jsxs("div",{className:"bg-gray-700 rounded-lg p-4 mb-6",children:[e.jsx("h4",{className:"font-medium text-white mb-3",children:"ì ê²€ ê²°ê³¼ ìš”ì•½"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(r,{className:"h-8 w-8 text-green-400 mb-1"}),e.jsx("span",{className:"text-2xl font-bold text-green-400",children:f}),e.jsx("span",{className:"text-xs text-gray-400",children:"í†µê³¼"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(x,{className:"h-8 w-8 text-yellow-400 mb-1"}),e.jsx("span",{className:"text-2xl font-bold text-yellow-400",children:E}),e.jsx("span",{className:"text-xs text-gray-400",children:"ê²½ê³ "})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(p,{className:"h-8 w-8 text-red-400 mb-1"}),e.jsx("span",{className:"text-2xl font-bold text-red-400",children:k}),e.jsx("span",{className:"text-xs text-gray-400",children:"ì‹¤íŒ¨"})]})]}),e.jsxs("div",{className:"mt-3 text-center text-sm text-gray-400",children:["ì´ ",v,"ê°œ í•­ëª© ì¤‘ ",f,"ê°œ í†µê³¼"]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"font-medium text-white mb-4",children:"ìƒì„¸ ì ê²€ í•­ëª©"}),e.jsx("div",{className:"space-y-3",children:d.checks.map(t=>e.jsxs("div",{className:`p-4 rounded-lg border ${y(t.status)}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center",children:[b(t.status),e.jsx("span",{className:"ml-2 font-medium text-white",children:t.title}),t.isBlocking&&"FAIL"===t.status&&e.jsx("span",{className:"ml-2 px-2 py-1 bg-red-600 text-white text-xs rounded",children:"ì°¨ë‹¨"})]}),e.jsx("span",{className:"text-xs text-gray-400 capitalize",children:t.category.toLowerCase()})]}),e.jsx("p",{className:"text-sm text-gray-300 mb-2",children:t.message}),t.recommendation&&e.jsxs("p",{className:"text-xs text-gray-400 italic",children:["ğŸ’¡ ",t.recommendation]})]},t.id))})]}),d.warnings.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h4",{className:"font-medium text-white mb-4 flex items-center",children:[e.jsx(n,{className:"h-5 w-5 mr-2 text-yellow-400"}),"ìœ„í—˜ ê²½ê³ "]}),e.jsx("div",{className:"space-y-3",children:d.warnings.map(t=>e.jsxs("div",{className:"p-4 rounded-lg border border-yellow-500/30 bg-yellow-900/10",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center",children:[N(t.type),e.jsx("span",{className:"ml-2 font-medium text-white",children:t.title})]}),e.jsx("span",{className:"text-xs text-gray-400 capitalize",children:t.category.toLowerCase()})]}),e.jsx("p",{className:"text-sm text-gray-300 mb-2",children:t.message}),e.jsxs("p",{className:"text-xs text-gray-400 italic",children:["ğŸ’¡ ",t.recommendation]})]},t.id))})]}),m&&e.jsxs("div",{className:"mb-6 p-4 bg-red-900/20 border border-red-500/30 rounded-lg",children:[e.jsxs("h4",{className:"font-medium text-red-400 mb-3 flex items-center",children:[e.jsx(n,{className:"h-5 w-5 mr-2"}),"ìœ„í—˜ ê²½ê³  ë¬´ì‹œí•˜ê³  ì§„í–‰"]}),e.jsx("p",{className:"text-sm text-gray-300 mb-4",children:"ì•ˆì „ ì ê²€ì—ì„œ ì‹¤íŒ¨í•œ í•­ëª©ì´ ìˆìŠµë‹ˆë‹¤. ê·¸ë˜ë„ ì§„í–‰í•˜ì‹œë ¤ë©´ ì´ìœ ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."}),e.jsx("textarea",{value:h,onChange:e=>g(e.target.value),className:"w-full px-3 py-2 bg-gray-700 text-white rounded focus:outline-none focus:ring-2 focus:ring-red-500",rows:3,placeholder:"ìœ„í—˜ì„ ê°ìˆ˜í•˜ê³  ì§„í–‰í•˜ëŠ” ì´ìœ ë¥¼ ì…ë ¥í•˜ì„¸ìš”...",required:!0}),e.jsxs("div",{className:"flex justify-end gap-2 mt-3",children:[e.jsx("button",{onClick:()=>u(!1),className:"px-4 py-2 text-gray-400 hover:text-gray-300",children:"ì·¨ì†Œ"}),e.jsx("button",{onClick:()=>{h.trim()&&(l(h),u(!1),g(""))},disabled:!h.trim(),className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"ê°•ì œ ì§„í–‰"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-700",children:[e.jsx("button",{onClick:a,className:"px-6 py-2 text-gray-400 hover:text-gray-300",children:"ì·¨ì†Œ"}),d.canProceed?e.jsxs("button",{onClick:j,className:"px-6 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 flex items-center",children:[e.jsx(r,{className:"h-5 w-5 mr-1"}),"ì•ˆì „í•˜ê²Œ ì§„í–‰"]}):e.jsxs("button",{onClick:j,className:"px-6 py-2 bg-red-600 text-white rounded hover:bg-red-700 flex items-center",children:[e.jsx(n,{className:"h-5 w-5 mr-1"}),"ìœ„í—˜ ê°ìˆ˜í•˜ê³  ì§„í–‰"]})]}),e.jsx("div",{className:"mt-4 p-3 bg-blue-900/20 border border-blue-500/30 rounded-lg",children:e.jsxs("p",{className:"text-xs text-blue-300",children:["ğŸ’¡ ",e.jsx("strong",{children:"ì•ˆì „ íˆ¬ì íŒ:"})," ìœ„í—˜ ê²½ê³ ê°€ ìˆì„ ë•ŒëŠ” íˆ¬ì ê¸ˆì•¡ì„ ì¤„ì´ê±°ë‚˜ ì‹œê¸°ë¥¼ ì¡°ì •í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. ê°ì •ì ì¸ ê²°ì •ë³´ë‹¤ëŠ” ì²´ê³„ì ì¸ ì ‘ê·¼ì„ ê¶Œì¥í•©ë‹ˆë‹¤."]})})]})})},f=({isOpen:t,onClose:r,onSubmit:n,entry:o,plan:m,currency:x})=>{const[u,g]=s.useState(0),[b,p]=s.useState(0),[y,f]=s.useState(null),[v,E]=s.useState(!1),[k,I]=s.useState(null),[C,P]=s.useState(!1),[A,L]=s.useState(!1);s.useEffect(()=>{if(t&&m&&(B(),o&&0===b)){const e=Math.floor(o.plannedAmount/(b||1));g(e)}},[t,m,o,b]);const B=async()=>{if(m)try{const e=await a.getCashBalance(m.portfolioId);f(e)}catch(e){}},S=async()=>{E(!0);try{await n({quantity:u,price:b}),r(),g(0),p(0),I(null)}catch(e){alert("íˆ¬ì ì‹¤í–‰ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{E(!1)}},M=u*b,D=!!y&&M<=y.cashBalance,R=o&&b>0?Math.floor(o.plannedAmount/b):0,O=o?M-o.plannedAmount:0;return t&&o&&m?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 w-full max-w-lg mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-white",children:[o.entryNumber,"íšŒì°¨ ë§¤ìˆ˜ ì‹¤í–‰"]}),e.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-300",disabled:v||A,children:e.jsx(w,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"bg-gray-700 p-4 rounded-lg mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-white",children:m.symbol}),e.jsx("span",{className:"text-sm text-gray-400",children:m.name})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"ê³„íš ê¸ˆì•¡:"}),e.jsx("span",{className:"ml-2 text-white",children:i(o.plannedAmount,x)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"íšŒì°¨:"}),e.jsxs("span",{className:"ml-2 text-white",children:[o.entryNumber,"/",m.plannedEntries]})]})]})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!o||!m||u<=0||b<=0)return void alert("ìˆ˜ëŸ‰ê³¼ ê°€ê²©ì„ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”.");if(y&&u*b>y.cashBalance){const e=`í˜„ê¸ˆ ì”ê³ (${i(y.cashBalance,x)})ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;if(!window.confirm(e))return}await(async()=>{if(!(!m||!o||u<=0||b<=0)){L(!0);try{const e=u*b,t=await l.createInvestmentChecklist(m.portfolioId,m.symbol,e);I(t),!t.canProceed||t.warnings.length>0?P(!0):S()}catch(e){S()}finally{L(!1)}}})()},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2 text-gray-300",children:["ë§¤ìˆ˜ ê°€ê²© (",x,")"]}),e.jsx("input",{type:"number",value:b,onChange:e=>p(Number(e.target.value)),className:"w-full px-4 py-2 bg-gray-700 text-white rounded focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0",step:"0.01",placeholder:"ë§¤ìˆ˜í•  ê°€ê²©",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-300",children:"ë§¤ìˆ˜ ìˆ˜ëŸ‰"}),e.jsx("input",{type:"number",value:u,onChange:e=>g(Number(e.target.value)),className:"w-full px-4 py-2 bg-gray-700 text-white rounded focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0",step:"1",placeholder:"ë§¤ìˆ˜í•  ìˆ˜ëŸ‰",required:!0}),b>0&&e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["ê¶Œì¥ ìˆ˜ëŸ‰: ",R,"ì£¼ (ê³„íš ê¸ˆì•¡ ê¸°ì¤€)"]})]}),u>0&&b>0&&e.jsxs("div",{className:"bg-gray-700 p-4 rounded-lg",children:[e.jsxs("h4",{className:"text-sm font-medium mb-3 text-gray-300 flex items-center",children:[e.jsx(j,{className:"h-4 w-4 mr-1"}),"ë§¤ìˆ˜ ì •ë³´"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"ì´ ë§¤ìˆ˜ ê¸ˆì•¡:"}),e.jsx("span",{className:"font-medium "+(D?"text-white":"text-red-400"),children:i(M,x)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"ê³„íš ê¸ˆì•¡ ëŒ€ë¹„:"}),e.jsxs("span",{className:"font-medium "+(O>0?"text-red-400":O<0?"text-green-400":"text-white"),children:[O>0?"+":"",i(O,x)]})]}),y&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"ë§¤ìˆ˜ í›„ í˜„ê¸ˆ:"}),e.jsx("span",{className:"font-medium "+(y.cashBalance-M>=0?"text-green-400":"text-red-400"),children:i(y.cashBalance-M,x)})]})]})]}),y&&e.jsxs("div",{className:"bg-blue-900/20 border border-blue-500/30 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(d,{className:"h-4 w-4 mr-1 text-blue-400"}),e.jsx("span",{className:"text-sm font-medium text-blue-400",children:"í˜„ê¸ˆ í˜„í™©"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"ì‚¬ìš© ê°€ëŠ¥:"}),e.jsx("span",{className:"ml-1 text-white",children:i(y.cashBalance,x)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"í™œìš©ë¥ :"}),e.jsxs("span",{className:"ml-1 text-white",children:[y.utilizationRate.toFixed(1),"%"]})]})]})]}),!D&&M>0&&e.jsx("div",{className:"bg-red-900/30 border border-red-500/50 p-3 rounded-lg",children:e.jsx("p",{className:"text-red-400 text-sm",children:"âš ï¸ í˜„ê¸ˆ ì”ê³ ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. ë§¤ìˆ˜ ê¸ˆì•¡ì„ í™•ì¸í•´ì£¼ì„¸ìš”."})}),Math.abs(O)>.1*o.plannedAmount&&e.jsx("div",{className:"bg-yellow-900/30 border border-yellow-500/50 p-3 rounded-lg",children:e.jsxs("p",{className:"text-yellow-400 text-sm",children:["ğŸ’¡ ê³„íš ê¸ˆì•¡ê³¼ ",Math.abs(O)>0?"10% ì´ìƒ":""," ì°¨ì´ê°€ ìˆìŠµë‹ˆë‹¤."]})}),e.jsxs("div",{className:"bg-blue-900/20 border border-blue-500/30 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx(c,{className:"h-4 w-4 mr-1 text-blue-400"}),e.jsx("span",{className:"text-sm font-medium text-blue-400",children:"ìŠ¤ë§ˆíŠ¸ ìœ„í—˜ ê´€ë¦¬"})]}),e.jsx("p",{className:"text-xs text-blue-300",children:"ë§¤ìˆ˜ ì‹¤í–‰ ì „ í¬íŠ¸í´ë¦¬ì˜¤ ìœ„í—˜ë„ë¥¼ ìë™ìœ¼ë¡œ ë¶„ì„í•˜ì—¬ ì•ˆì „í•œ íˆ¬ìë¥¼ ë„ì™€ë“œë¦½ë‹ˆë‹¤."})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:r,className:"px-4 py-2 text-gray-400 hover:text-gray-300",disabled:v||A,children:"ì·¨ì†Œ"}),e.jsx("button",{type:"submit",disabled:v||A||u<=0||b<=0,className:"px-6 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:A?e.jsxs(e.Fragment,{children:[e.jsx(c,{className:"h-4 w-4 mr-1 animate-spin"}),"ìœ„í—˜ ë¶„ì„ ì¤‘..."]}):v?e.jsxs(e.Fragment,{children:[e.jsx(h,{className:"h-4 w-4 mr-1"}),"ì‹¤í–‰ ì¤‘..."]}):e.jsxs(e.Fragment,{children:[e.jsx(h,{className:"h-4 w-4 mr-1"}),"ì•ˆì „ ì ê²€ í›„ ë§¤ìˆ˜"]})})]})]})]})}),e.jsx(N,{isOpen:C,onClose:()=>P(!1),onProceed:async e=>{E(!0);try{await n({quantity:u,price:b},e),P(!1),r(),g(0),p(0),I(null)}catch(t){alert("íˆ¬ì ì‹¤í–‰ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{E(!1)}},checklist:k,currency:x})]}):null};class v{static async create(e){const s=await t.addInvestmentPlan(e),a=await this.getById(s);if(!a)throw new Error("íˆ¬ì ê³„íš ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");return a}static async getById(e){const s=await t.investmentPlans.get(e);if(s)return s.entries=await t.investmentEntries.where("planId").equals(e).toArray(),s}static async getByPortfolioId(e){return await t.getInvestmentPlans(e)}static async getAll(){return await t.getInvestmentPlans()}static async update(e,s){await t.investmentPlans.update(e,{...s,updatedAt:Date.now()})}static async delete(e){await t.transaction("rw",[t.investmentPlans,t.investmentEntries],async()=>{await t.investmentEntries.where("planId").equals(e).delete(),await t.investmentPlans.delete(e)})}static async executeEntry(e,s){const a=await t.investmentEntries.get(e);if(!a||"PLANNED"!==a.status)throw new Error("ì‹¤í–‰í•  ìˆ˜ ì—†ëŠ” íˆ¬ì ê³„íšì…ë‹ˆë‹¤.");const r=await this.getById(a.planId);if(!r)throw new Error("íˆ¬ì ê³„íšì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");const n={portfolioId:r.portfolioId,symbol:r.symbol,name:r.name,quantity:s.quantity,avgPrice:s.price,currentPrice:s.price,tradeDate:Date.now(),strategyCategory:"UNCATEGORIZED",strategyTags:[`íˆ¬ìê³„íš-${r.id}`,`${a.entryNumber}íšŒì°¨`]},l=await o.createPosition(n);await t.executeInvestmentEntry(e,{quantity:s.quantity,price:s.price,positionId:l.id})}static async cancelPlan(e){const t=await this.getById(e);if(!t)throw new Error("íˆ¬ì ê³„íšì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");if(t.executedEntries>0)throw new Error("ì´ë¯¸ ì‹¤í–‰ëœ íšŒì°¨ê°€ ìˆëŠ” ê³„íšì€ ì·¨ì†Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");await this.update(e,{status:"CANCELLED"})}static async getPlanStats(e){const t=e?await this.getByPortfolioId(e):await this.getAll();return{totalPlans:t.length,activePlans:t.filter(e=>"PLANNED"===e.status||"IN_PROGRESS"===e.status).length,completedPlans:t.filter(e=>"COMPLETED"===e.status).length,cancelledPlans:t.filter(e=>"CANCELLED"===e.status).length,totalBudget:t.reduce((e,t)=>e+t.totalBudget,0),executedBudget:t.reduce((e,t)=>e+(t.totalBudget-t.remainingBudget),0),remainingBudget:t.reduce((e,t)=>e+t.remainingBudget,0)}}static async getNextExecutableEntry(e){const t=await this.getById(e);if(!t||"COMPLETED"===t.status||"CANCELLED"===t.status)return null;return t.entries.filter(e=>"PLANNED"===e.status).sort((e,t)=>e.entryNumber-t.entryNumber)[0]||null}static async getPlanSummary(e){const t=await this.getById(e);if(!t)return null;const s=t.entries.filter(e=>"EXECUTED"===e.status),a=s.reduce((e,t)=>e+(t.executedAmount||0),0),r=s.reduce((e,t)=>e+(t.quantity||0),0);return{plan:t,executedAmount:a,totalQuantity:r,averagePrice:r>0?a/r:0,progressRate:t.executedEntries/t.plannedEntries*100,nextEntry:await this.getNextExecutableEntry(e)}}}export{f as E,v as I,h as P,p as X,w as a};
//# sourceMappingURL=investmentPlanService-3da82a4f.js.map
