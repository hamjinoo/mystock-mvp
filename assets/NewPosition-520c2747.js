import{r as e,j as t}from"./react-265ec861.js";import{C as s}from"./CurrencyInput-1751f9bd.js";import{L as r}from"./index-65335e1b.js";import{A as a}from"./accountService-26154c96.js";import{P as n}from"./portfolioService-3819a654.js";import{j as c,b as l}from"./vendor-936e0d4d.js";import"./dexie-e331f4d1.js";import"./currencyUtils-b432909e.js";import"./router-a48e489e.js";const i=()=>{const{accountId:i}=c(),o=l(),[u,d]=e.useState(),[m,x]=e.useState([]),[p,b]=e.useState(!0),[h,f]=e.useState(""),[g,j]=e.useState(""),[y,N]=e.useState(0),[v,w]=e.useState(0),[C,S]=e.useState(0),[I,k]=e.useState();e.useEffect((()=>{q()}),[i]);const q=async()=>{if(i)try{await n.fixPortfolioData();const e=await a.getById(Number(i));if(!e)throw new Error("계좌를 찾을 수 없습니다.");d(e);const t=await n.getAll();if(x(t),t.length>0){const e=t.filter((e=>e.accountId===Number(i))),s=e.length>0?e[0]:t[0];k(s.id)}}catch(e){}finally{b(!1)}},A=m.find((e=>e.id===I)),P=A?.currency||u?.currency||"KRW";return p?t.jsx("div",{className:"container mx-auto px-4 py-8",children:t.jsx("div",{className:"flex justify-center items-center h-64",children:t.jsx(r,{})})}):u?0===m.length?t.jsx("div",{className:"container mx-auto px-4 py-8",children:t.jsxs("div",{className:"max-w-2xl mx-auto text-center",children:[t.jsx("h1",{className:"text-2xl font-bold mb-4",children:"새 종목"}),t.jsx("p",{className:"text-gray-400 mb-4",children:"포트폴리오가 없습니다."}),t.jsx("button",{onClick:()=>o("/portfolios/new"),className:"px-6 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"새 포트폴리오 만들기"})]})}):t.jsx("div",{className:"container mx-auto px-4 py-8",children:t.jsxs("div",{className:"max-w-2xl mx-auto",children:[t.jsx("h1",{className:"text-2xl font-bold mb-8",children:"새 종목"}),t.jsx("div",{className:"mb-4 p-4 bg-blue-900/20 border border-blue-500/30 rounded-lg",children:t.jsxs("p",{className:"text-sm text-blue-400",children:["💡 ",t.jsx("strong",{children:"팁:"})," 이제 모든 포트폴리오에서 선택할 수 있습니다. 동일한 종목을 여러 포트폴리오에 나누어 관리하여 리밸런싱을 더 쉽게 할 수 있습니다."]})}),t.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),i&&I)try{const e=m.find((e=>e.id===I));if(!e)throw new Error("선택한 포트폴리오를 찾을 수 없습니다.");const t={portfolioId:I,symbol:h.trim().toUpperCase(),name:g.trim()||h.trim().toUpperCase(),quantity:y,avgPrice:v,currentPrice:C,tradeDate:Date.now(),strategyCategory:e.config?.period||"UNCATEGORIZED",strategyTags:[]};await n.createPosition(t);const s=e.accountId;o(`/accounts/${s}`)}catch(t){alert("포지션 생성에 실패했습니다.")}},className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"포트폴리오 선택"}),t.jsx("select",{value:I,onChange:e=>k(Number(e.target.value)),className:"w-full px-4 py-2 bg-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:m.map((e=>t.jsxs("option",{value:e.id,children:[e.name," (",e.config?.period||"미분류",") -"," ",e.currency]},e.id)))}),t.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["현재 계좌: ",u.accountName," (",u.broker,")"]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"종목 코드"}),t.jsx("input",{type:"text",value:h,onChange:e=>f(e.target.value),className:"w-full px-4 py-2 bg-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"예: AAPL, 005930",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"종목명"}),t.jsx("input",{type:"text",value:g,onChange:e=>j(e.target.value),className:"w-full px-4 py-2 bg-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"예: Apple Inc., 삼성전자"})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"수량"}),t.jsx("input",{type:"number",value:y,onChange:e=>N(Number(e.target.value)),className:"w-full px-4 py-2 bg-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0",step:"1",placeholder:"예: 10",required:!0})]}),t.jsx(s,{label:"평균단가",value:v,onChange:w,currency:P,required:!0,type:"price"}),t.jsx(s,{label:"현재가",value:C,onChange:S,currency:P,required:!0,type:"price"})]}),t.jsxs("div",{className:"flex justify-end space-x-4",children:[t.jsx("button",{type:"button",onClick:()=>{const e=m.find((e=>e.id===I)),t=e?e.accountId:i;o(`/accounts/${t}`)},className:"px-6 py-2 text-gray-400 hover:text-gray-300",children:"취소"}),t.jsx("button",{type:"submit",className:"px-6 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",disabled:!I||!h.trim()||y<=0||v<=0||C<=0,children:"생성"})]})]})]})}):t.jsx("div",{className:"p-4",children:t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-gray-400",children:"계좌를 찾을 수 없습니다."}),t.jsx("button",{onClick:()=>o("/accounts"),className:"mt-4 text-blue-500 hover:text-blue-400",children:"계좌 목록으로 돌아가기"})]})})};export{i as NewPositionPage,i as default};
//# sourceMappingURL=NewPosition-520c2747.js.map
