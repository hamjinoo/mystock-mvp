import{j as e,L as s,C as t}from"./index-e48b942e.js";import{e as r,u as a,r as l}from"./react-2981e50d.js";import{I as n,P as c,E as i,X as d}from"./investmentPlanService-3da82a4f.js";import{P as x}from"./portfolioService-309953aa.js";import{f as m}from"./currencyUtils-b432909e.js";import{A as o}from"./ArrowLeftIcon-57afa31b.js";import{C as u}from"./CurrencyDollarIcon-1e6343ac.js";import{C as h}from"./CalendarDaysIcon-f532a94c.js";import{a as j,E as N,C as g}from"./riskManagementService-c38bc133.js";import"./dexie-5294e5fd.js";import"./accountService-f5f42876.js";import"./ShieldCheckIcon-3f143148.js";const b=()=>{const{portfolioId:b,planId:p}=r(),y=a(),[f,v]=l.useState(null),[w,E]=l.useState(null),[C,L]=l.useState(null),[S,A]=l.useState(!0),[D,P]=l.useState(!1),[I,B]=l.useState(null);l.useEffect(()=>{p&&b&&k()},[p,b]);const k=async()=>{if(p&&b)try{const[e,s,t]=await Promise.all([n.getById(Number(p)),x.getById(Number(b)),n.getPlanSummary(Number(p))]);v(e||null),E(s||null),L(t)}catch(e){}finally{A(!1)}},O=e=>{B(e),P(!0)},T=s=>{switch(s){case"EXECUTED":return e.jsx(j,{className:"h-5 w-5 text-green-400"});case"CANCELLED":return e.jsx(d,{className:"h-5 w-5 text-red-400"});default:return e.jsx(g,{className:"h-5 w-5 text-gray-400"})}};if(S)return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(s,{})})});if(!f||!w)return e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-400",children:"투자 계획을 찾을 수 없습니다."}),e.jsx("button",{onClick:()=>y(`/portfolios/${b}/investment-plans`),className:"mt-4 text-blue-500 hover:text-blue-400",children:"목록으로 돌아가기"})]})});const $=f.executedEntries/f.plannedEntries*100,R=f.entries.filter(e=>"PLANNED"===e.status).sort((e,s)=>e.entryNumber-s.entryNumber)[0];return e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("button",{onClick:()=>y(`/portfolios/${b}/investment-plans`),className:"text-sm text-gray-400 hover:text-white flex items-center",children:[e.jsx(o,{className:"h-4 w-4 mr-1"}),"투자 계획 목록"]})}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:f.symbol}),e.jsx("p",{className:"text-gray-400",children:f.name}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:w.name})]}),e.jsx("div",{className:`px-3 py-1 rounded border ${(e=>{switch(e){case"PLANNED":return"text-blue-400 bg-blue-900/20 border-blue-500/30";case"IN_PROGRESS":return"text-yellow-400 bg-yellow-900/20 border-yellow-500/30";case"COMPLETED":return"text-green-400 bg-green-900/20 border-green-500/30";case"CANCELLED":return"text-red-400 bg-red-900/20 border-red-500/30";default:return"text-gray-400 bg-gray-900/20 border-gray-500/30"}})(f.status)}`,children:e.jsx("span",{className:"text-sm font-medium",children:(e=>{switch(e){case"PLANNED":return"계획됨";case"IN_PROGRESS":return"진행 중";case"COMPLETED":return"완료";case"CANCELLED":return"취소됨";default:return"알 수 없음"}})(f.status)})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-gray-400",children:"전체 진행률"}),e.jsxs("span",{className:"text-white",children:[$.toFixed(0),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-3",children:e.jsx("div",{className:"bg-blue-500 h-3 rounded-full transition-all duration-300",style:{width:`${$}%`}})}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[e.jsxs("span",{children:[f.executedEntries,"/",f.plannedEntries," 회차 완료"]}),e.jsxs("span",{children:[m(f.totalBudget-f.remainingBudget,w.currency)," /",m(f.totalBudget,w.currency)]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center mb-1",children:[e.jsx(u,{className:"h-4 w-4 text-green-400 mr-1"}),e.jsx("span",{className:"text-xs text-gray-400",children:"총 예산"})]}),e.jsx("p",{className:"text-lg font-bold text-white",children:m(f.totalBudget,w.currency)})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center mb-1",children:[e.jsx(t,{className:"h-4 w-4 text-blue-400 mr-1"}),e.jsx("span",{className:"text-xs text-gray-400",children:"실행 금액"})]}),e.jsx("p",{className:"text-lg font-bold text-white",children:m(f.totalBudget-f.remainingBudget,w.currency)})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center mb-1",children:[e.jsx(h,{className:"h-4 w-4 text-yellow-400 mr-1"}),e.jsx("span",{className:"text-xs text-gray-400",children:"계획 회차"})]}),e.jsxs("p",{className:"text-lg font-bold text-white",children:[f.plannedEntries,"회"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center mb-1",children:[e.jsx(j,{className:"h-4 w-4 text-green-400 mr-1"}),e.jsx("span",{className:"text-xs text-gray-400",children:"완료 회차"})]}),e.jsxs("p",{className:"text-lg font-bold text-white",children:[f.executedEntries,"회"]})]})]})]}),R&&"CANCELLED"!==f.status&&e.jsxs("div",{className:"bg-blue-900/20 border border-blue-500/30 rounded-lg p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-bold text-blue-400",children:"다음 실행 회차"}),e.jsxs("span",{className:"text-sm text-blue-300",children:[R.entryNumber,"회차 / ",f.plannedEntries,"회차"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-400",children:"계획 금액:"}),e.jsx("span",{className:"ml-2 text-white font-medium",children:m(R.plannedAmount,w.currency)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-400",children:"예상 수량:"}),e.jsx("span",{className:"ml-2 text-white font-medium",children:"시장가 기준 계산"})]})]}),e.jsxs("button",{onClick:()=>O(R),className:"w-full px-4 py-3 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors flex items-center justify-center",children:[e.jsx(c,{className:"h-5 w-5 mr-2"}),R.entryNumber,"회차 매수 실행"]})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"실행 내역"}),e.jsx("div",{className:"space-y-3",children:f.entries.sort((e,s)=>e.entryNumber-s.entryNumber).map(s=>e.jsxs("div",{className:"p-4 rounded-lg border "+("EXECUTED"===s.status?"bg-green-900/10 border-green-500/30":"CANCELLED"===s.status?"bg-red-900/10 border-red-500/30":"bg-gray-700 border-gray-600"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center",children:[T(s.status),e.jsxs("span",{className:"ml-2 font-medium text-white",children:[s.entryNumber,"회차"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"계획 금액"}),e.jsx("p",{className:"font-medium text-white",children:m(s.plannedAmount,w.currency)})]})]}),"EXECUTED"===s.status&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-3 pt-3 border-t border-gray-600",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-400",children:"실행 금액"}),e.jsx("p",{className:"text-sm font-medium text-white",children:m(s.executedAmount||0,w.currency)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-400",children:"매수 수량"}),e.jsxs("p",{className:"text-sm font-medium text-white",children:[s.quantity?.toLocaleString()||0,"주"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-400",children:"매수 단가"}),e.jsx("p",{className:"text-sm font-medium text-white",children:m(s.price||0,w.currency)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-400",children:"실행 일시"}),e.jsx("p",{className:"text-sm font-medium text-white",children:s.executedAt?new Date(s.executedAt).toLocaleDateString():"-"})]})]}),"PLANNED"===s.status&&s===R&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-600",children:e.jsxs("button",{onClick:()=>O(s),className:"w-full px-3 py-2 bg-blue-500 text-white text-sm rounded hover:bg-blue-600 transition-colors",children:[e.jsx(c,{className:"h-4 w-4 inline mr-1"}),"실행하기"]})})]},s.id))})]}),C&&C.executedAmount>0&&e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"투자 요약"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-400",children:"총 실행 금액"}),e.jsx("p",{className:"text-lg font-bold text-white",children:m(C.executedAmount,w.currency)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-400",children:"총 보유 수량"}),e.jsxs("p",{className:"text-lg font-bold text-white",children:[C.totalQuantity.toLocaleString(),"주"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-400",children:"평균 매수가"}),e.jsx("p",{className:"text-lg font-bold text-white",children:m(C.averagePrice,w.currency)})]})]})]}),e.jsx("div",{className:"flex gap-3",children:"PLANNED"===f.status&&0===f.executedEntries&&e.jsxs("button",{onClick:async()=>{if(!f)return;if(window.confirm("정말 이 투자 계획을 취소하시겠습니까?"))try{await n.cancelPlan(f.id),y(`/portfolios/${b}/investment-plans`)}catch(e){alert("투자 계획 취소에 실패했습니다.")}},className:"flex items-center px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors",children:[e.jsx(N,{className:"h-5 w-5 mr-1"}),"계획 취소"]})}),e.jsx(i,{isOpen:D,onClose:()=>{P(!1),B(null)},onSubmit:async e=>{if(I)try{await n.executeEntry(I.id,e),k(),P(!1),B(null)}catch(s){throw s}},entry:I,plan:f,currency:w.currency})]})})};export{b as InvestmentPlanDetailPage};
//# sourceMappingURL=InvestmentPlanDetailPage-80d38f63.js.map
