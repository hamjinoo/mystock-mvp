import{j as e,C as s,L as t}from"./index-e48b942e.js";import{r as a,L as l,e as r,u as n}from"./react-2981e50d.js";import{P as c,X as i,a as d,I as x,E as m}from"./investmentPlanService-3da82a4f.js";import{f as o}from"./currencyUtils-b432909e.js";import{C as u}from"./CurrencyDollarIcon-1e6343ac.js";import{C as h,a as j}from"./riskManagementService-c38bc133.js";import{A as g}from"./accountService-f5f42876.js";import{C as b}from"./CalendarDaysIcon-f532a94c.js";import{P as N}from"./portfolioService-309953aa.js";import{A as p}from"./ArrowLeftIcon-57afa31b.js";import{P as y}from"./PlusIcon-59184969.js";import"./dexie-5294e5fd.js";import"./ShieldCheckIcon-3f143148.js";function f({title:e,titleId:s,...t},l){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:l,"aria-labelledby":s},t),e?a.createElement("title",{id:s},e):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.5 14.25v2.25m3-4.5v4.5m3-6.75v6.75m3-9v9M6 20.25h12A2.25 2.25 0 0 0 20.25 18V6A2.25 2.25 0 0 0 18 3.75H6A2.25 2.25 0 0 0 3.75 6v12A2.25 2.25 0 0 0 6 20.25Z"}))}const v=a.forwardRef(f),w=({plan:t,currency:a,portfolioId:r,onExecuteEntry:n,onCancelPlan:d})=>{const x=t.executedEntries/t.plannedEntries*100,m=t.entries.filter(e=>"PLANNED"===e.status).sort((e,s)=>e.entryNumber-s.entryNumber)[0];return e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-white",children:t.symbol}),e.jsx("p",{className:"text-sm text-gray-400",children:t.name})]}),e.jsxs("div",{className:`flex items-center ${(e=>{switch(e){case"PLANNED":return"text-blue-400";case"IN_PROGRESS":return"text-yellow-400";case"COMPLETED":return"text-green-400";case"CANCELLED":return"text-red-400";default:return"text-gray-400"}})(t.status)}`,children:[(s=>{switch(s){case"PLANNED":default:return e.jsx(h,{className:"h-4 w-4"});case"IN_PROGRESS":return e.jsx(c,{className:"h-4 w-4"});case"COMPLETED":return e.jsx(j,{className:"h-4 w-4"});case"CANCELLED":return e.jsx(i,{className:"h-4 w-4"})}})(t.status),e.jsx("span",{className:"ml-1 text-xs font-medium",children:(e=>{switch(e){case"PLANNED":return"계획됨";case"IN_PROGRESS":return"진행 중";case"COMPLETED":return"완료";case"CANCELLED":return"취소됨";default:return"알 수 없음"}})(t.status)})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-400",children:"진행률"}),e.jsxs("span",{className:"text-white",children:[x.toFixed(0),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:`${x}%`}})}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[e.jsxs("span",{children:[t.executedEntries,"/",t.plannedEntries," 회차"]}),e.jsxs("span",{children:[o(t.totalBudget-t.remainingBudget,a)," / ",o(t.totalBudget,a)]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{className:"bg-gray-700 p-3 rounded",children:[e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx(u,{className:"h-4 w-4 text-green-400 mr-1"}),e.jsx("span",{className:"text-xs text-gray-400",children:"총 예산"})]}),e.jsx("p",{className:"text-sm font-medium text-white",children:o(t.totalBudget,a)})]}),e.jsxs("div",{className:"bg-gray-700 p-3 rounded",children:[e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx(s,{className:"h-4 w-4 text-blue-400 mr-1"}),e.jsx("span",{className:"text-xs text-gray-400",children:"남은 예산"})]}),e.jsx("p",{className:"text-sm font-medium text-white",children:o(t.remainingBudget,a)})]})]}),m&&"CANCELLED"!==t.status&&e.jsxs("div",{className:"bg-blue-900/20 border border-blue-500/30 p-3 rounded mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-blue-400",children:["다음 회차: ",m.entryNumber,"회차"]}),e.jsx("span",{className:"text-sm text-blue-300",children:o(m.plannedAmount,a)})]}),e.jsxs("button",{onClick:()=>n(m),className:"w-full px-3 py-2 bg-blue-500 text-white text-sm rounded hover:bg-blue-600 transition-colors",children:[e.jsx(c,{className:"h-4 w-4 inline mr-1"}),m.entryNumber,"회차 매수 실행"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{to:`/portfolios/${r}/investment-plans/${t.id}`,className:"flex-1 px-3 py-2 bg-gray-700 text-white text-sm rounded hover:bg-gray-600 transition-colors text-center",children:"상세 보기"}),"PLANNED"===t.status&&0===t.executedEntries&&e.jsx("button",{onClick:()=>d(t.id),className:"px-3 py-2 bg-red-600 text-white text-sm rounded hover:bg-red-700 transition-colors",children:"취소"})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-700",children:[e.jsx("div",{className:"flex justify-between items-center mb-2",children:e.jsx("span",{className:"text-xs text-gray-400",children:"회차별 진행 상황"})}),e.jsx("div",{className:"flex gap-1",children:t.entries.map(s=>e.jsx("div",{className:"flex-1 h-2 rounded "+("EXECUTED"===s.status?"bg-green-500":"CANCELLED"===s.status?"bg-red-500":"bg-gray-600"),title:`${s.entryNumber}회차 - ${"EXECUTED"===s.status?"실행됨":"CANCELLED"===s.status?"취소됨":"대기 중"}`},s.id))})]})]})},E=({isOpen:s,onClose:t,onSubmit:l,portfolio:r,initialSymbol:n="",initialName:c=""})=>{const[i,x]=a.useState(n),[m,h]=a.useState(c),[j,N]=a.useState(0),[p,y]=a.useState(3),[f,v]=a.useState(null),[w,E]=a.useState(!1);a.useEffect(()=>{s&&(C(),x(n),h(c))},[s,r.accountId,n,c]);const C=async()=>{try{const e=await g.getCashBalance(r.accountId);v(e)}catch(e){}},S=p>0?j/p:0,L=!!f&&j<=f.cashBalance;return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 w-full max-w-lg mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:"투자 계획 생성"}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-300",disabled:w,children:e.jsx(d,{className:"h-6 w-6"})})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!i.trim()||!m.trim()||j<=0||p<=0)alert("모든 필드를 올바르게 입력해주세요.");else{if(f&&j>f.cashBalance){const e=`현금 잔고(${o(f.cashBalance,r.currency)})를 초과하는 계획입니다. 계속하시겠습니까?`;if(!window.confirm(e))return}E(!0);try{const e={portfolioId:r.id,symbol:i.trim().toUpperCase(),name:m.trim(),totalBudget:j,plannedEntries:p,executedEntries:0,remainingBudget:j,status:"PLANNED"};await l(e),t(),x(""),h(""),N(0),y(3)}catch(s){alert("투자 계획 생성에 실패했습니다.")}finally{E(!1)}}},className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-300",children:"종목 코드"}),e.jsx("input",{type:"text",value:i,onChange:e=>x(e.target.value),className:"w-full px-4 py-2 bg-gray-700 text-white rounded focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"예: AAPL, 005930",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-300",children:"종목명"}),e.jsx("input",{type:"text",value:m,onChange:e=>h(e.target.value),className:"w-full px-4 py-2 bg-gray-700 text-white rounded focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"예: Apple Inc.",required:!0})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2 text-gray-300",children:["총 투자 금액 (",r.currency,")"]}),e.jsx("input",{type:"number",value:j,onChange:e=>N(Number(e.target.value)),className:"w-full px-4 py-2 bg-gray-700 text-white rounded focus:outline-none focus:ring-2 "+(L?"focus:ring-blue-500":"focus:ring-red-500 border border-red-500"),min:"0",step:"10000",required:!0}),f&&e.jsxs("p",{className:"text-xs mt-1 "+(L?"text-gray-400":"text-red-400"),children:["사용 가능 현금: ",o(f.cashBalance,r.currency),!L&&" (부족)"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-300",children:"분할 매수 횟수"}),e.jsxs("select",{value:p,onChange:e=>y(Number(e.target.value)),className:"w-full px-4 py-2 bg-gray-700 text-white rounded focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:1,children:"1회 (일괄 매수)"}),e.jsx("option",{value:2,children:"2회 분할"}),e.jsx("option",{value:3,children:"3회 분할"}),e.jsx("option",{value:4,children:"4회 분할"}),e.jsx("option",{value:5,children:"5회 분할"})]})]}),p>1&&e.jsxs("div",{className:"bg-gray-700 p-4 rounded-lg",children:[e.jsxs("h4",{className:"text-sm font-medium mb-2 text-gray-300 flex items-center",children:[e.jsx(b,{className:"h-4 w-4 mr-1"}),"회차별 예상 투자 금액"]}),e.jsx("div",{className:"space-y-1",children:Array.from({length:p},(s,t)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-400",children:[t+1,"회차:"]}),e.jsx("span",{className:"text-white",children:o(t===p-1?j-S*(p-1):S,r.currency)})]},t))})]}),f&&e.jsxs("div",{className:"bg-blue-900/20 border border-blue-500/30 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(u,{className:"h-4 w-4 mr-1 text-blue-400"}),e.jsx("span",{className:"text-sm font-medium text-blue-400",children:"현금 현황"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"사용 가능:"}),e.jsx("span",{className:"ml-1 text-white",children:o(f.cashBalance,r.currency)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"사용 후:"}),e.jsx("span",{className:"ml-1 "+(f.cashBalance-j>=0?"text-green-400":"text-red-400"),children:o(f.cashBalance-j,r.currency)})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 text-gray-400 hover:text-gray-300",disabled:w,children:"취소"}),e.jsx("button",{type:"submit",disabled:w||!i.trim()||!m.trim()||j<=0,className:"px-6 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed",children:w?"생성 중...":"계획 생성"})]})]})]})}):null},C=()=>{const{portfolioId:s}=r(),l=n(),[c,i]=a.useState(null),[d,u]=a.useState([]),[g,b]=a.useState(null),[f,C]=a.useState(!0),[S,L]=a.useState(!1),[P,A]=a.useState(!1),[B,D]=a.useState(null),[I,k]=a.useState(null);a.useEffect(()=>{s&&O()},[s]);const O=async()=>{if(s)try{const[e,t,a]=await Promise.all([N.getById(Number(s)),x.getByPortfolioId(Number(s)),x.getPlanStats(Number(s))]);i(e||null),u(t),b(a)}catch(e){}finally{C(!1)}},$=e=>{const s=d.find(s=>s.id===e.planId);s&&(D(e),k(s),A(!0))},R=async e=>{if(window.confirm("정말 이 투자 계획을 취소하시겠습니까?"))try{await x.cancelPlan(e),O()}catch(s){alert("투자 계획 취소에 실패했습니다.")}};return f?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(t,{})})}):c?e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("button",{onClick:()=>l(`/portfolios/${c.id}`),className:"text-sm text-gray-400 hover:text-white flex items-center mr-4",children:[e.jsx(p,{className:"h-4 w-4 mr-1"}),"뒤로"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"투자 계획"}),e.jsx("p",{className:"text-gray-400",children:c.name})]})]}),e.jsxs("button",{onClick:()=>L(!0),className:"inline-flex items-center px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:[e.jsx(y,{className:"h-5 w-5 mr-1"}),"새 계획"]})]}),g&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(v,{className:"h-5 w-5 text-blue-400 mr-2"}),e.jsx("span",{className:"text-sm text-gray-400",children:"총 계획"})]}),e.jsx("p",{className:"text-2xl font-bold text-white",children:g.totalPlans})]}),e.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(h,{className:"h-5 w-5 text-yellow-400 mr-2"}),e.jsx("span",{className:"text-sm text-gray-400",children:"진행 중"})]}),e.jsx("p",{className:"text-2xl font-bold text-white",children:g.activePlans})]}),e.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(j,{className:"h-5 w-5 text-green-400 mr-2"}),e.jsx("span",{className:"text-sm text-gray-400",children:"완료"})]}),e.jsx("p",{className:"text-2xl font-bold text-white",children:g.completedPlans})]}),e.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg",children:[e.jsx("div",{className:"flex items-center mb-2",children:e.jsx("span",{className:"text-sm text-gray-400",children:"총 예산"})}),e.jsx("p",{className:"text-2xl font-bold text-white",children:o(g.totalBudget,c.currency)}),e.jsxs("p",{className:"text-xs text-gray-500",children:["실행: ",o(g.executedBudget,c.currency)]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"투자 계획 목록"}),0===d.length?e.jsxs("div",{className:"text-center py-12 bg-gray-800 rounded-lg",children:[e.jsx("p",{className:"text-gray-400 mb-4",children:"등록된 투자 계획이 없습니다."}),e.jsxs("button",{onClick:()=>L(!0),className:"inline-flex items-center px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:[e.jsx(y,{className:"h-5 w-5 mr-1"}),"첫 번째 계획 만들기"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:d.map(s=>e.jsx(w,{plan:s,currency:c.currency,portfolioId:c.id,onExecuteEntry:$,onCancelPlan:R},s.id))})]}),e.jsx(E,{isOpen:S,onClose:()=>L(!1),onSubmit:async e=>{try{await x.create(e),O()}catch(s){throw s}},portfolio:c}),e.jsx(m,{isOpen:P,onClose:()=>{A(!1),D(null),k(null)},onSubmit:async e=>{if(B)try{await x.executeEntry(B.id,e),O(),A(!1),D(null),k(null)}catch(s){throw s}},entry:B,plan:I,currency:c.currency})]})}):e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-400",children:"포트폴리오를 찾을 수 없습니다."}),e.jsx("button",{onClick:()=>l("/portfolios"),className:"mt-4 text-blue-500 hover:text-blue-400",children:"포트폴리오 목록으로 돌아가기"})]})})};export{C as InvestmentPlansPage};
//# sourceMappingURL=InvestmentPlansPage-331ffcea.js.map
