import{d as e,j as t,L as a}from"./index-e48b942e.js";import{r as s}from"./react-2981e50d.js";import{P as o}from"./portfolioService-309953aa.js";import{P as l}from"./PlusIcon-59184969.js";import"./dexie-5294e5fd.js";class c{static async getAll(){return e.todos.toArray()}static async getByPortfolioId(t){return e.todos.where("portfolioId").equals(t).toArray()}static async create(t){const a=await e.todos.add(t),s=await e.todos.get(a);if(!s)throw new Error("할 일 생성에 실패했습니다.");return s}static async update(t,a){await e.todos.update(t,a);const s=await e.todos.get(t);if(!s)throw new Error("할 일 업데이트에 실패했습니다.");return s}static async delete(t){await e.todos.delete(t)}static async toggleDone(e){const t=await this.getById(e);if(!t)throw new Error("Todo not found");const a={...t,completed:!t.completed,done:!t.completed,completedAt:t.completed?null:Date.now()};await this.update(e,a)}static async getById(t){return await e.todos.get(t)}}const r=()=>{const[e,r]=s.useState([]),[i,n]=s.useState([]),[d,m]=s.useState(null),[u,x]=s.useState(""),[p,h]=s.useState(!0);s.useEffect(()=>{y()},[]);const y=async()=>{try{const[e,t]=await Promise.all([o.getAll(),c.getAll()]);r(e),n(t)}catch(e){}finally{h(!1)}},f=e=>new Intl.DateTimeFormat("ko-KR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(new Date(e));return p?t.jsx("div",{className:"container mx-auto px-4 py-8",children:t.jsx("div",{className:"flex justify-center items-center h-64",children:t.jsx(a,{})})}):t.jsx("div",{className:"container mx-auto px-4 py-8",children:t.jsxs("div",{className:"max-w-2xl mx-auto",children:[t.jsx("h1",{className:"text-2xl font-bold mb-8",children:"할 일 목록"}),t.jsxs("div",{className:"mb-6",children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"포트폴리오"}),t.jsxs("select",{value:d||"",onChange:e=>m(e.target.value?Number(e.target.value):null),className:"w-full px-4 py-2 bg-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"",children:"포트폴리오 선택"}),e.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]})]}),t.jsx("form",{onSubmit:async e=>{if(e.preventDefault(),u.trim()&&d)try{const e=await c.create({portfolioId:d,text:u.trim(),completed:!1,createdAt:Date.now(),completedAt:null});n([...i,e]),x("")}catch(t){alert("할 일 추가에 실패했습니다.")}},className:"mb-8",children:t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"text",value:u,onChange:e=>x(e.target.value),className:"flex-1 px-4 py-2 bg-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"새 할 일 추가",disabled:!d}),t.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed",disabled:!d||!u.trim(),children:t.jsx(l,{className:"h-5 w-5"})})]})}),t.jsx("div",{className:"space-y-4",children:i.filter(e=>!d||e.portfolioId===d).sort((e,t)=>t.createdAt-e.createdAt).map(e=>t.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("input",{type:"checkbox",checked:e.completed,onChange:()=>(async e=>{try{const t=await c.update(e.id,{...e,completed:!e.completed,completedAt:e.completed?null:Date.now()});n(i.map(a=>a.id===e.id?t:a))}catch(t){alert("할 일 상태 변경에 실패했습니다.")}})(e),className:"h-5 w-5 rounded border-gray-600 text-blue-500 focus:ring-blue-500 focus:ring-offset-gray-800"}),t.jsx("span",{className:e.completed?"line-through text-gray-400":"",children:e.text})]}),t.jsx("button",{onClick:()=>(async e=>{if(window.confirm("이 할 일을 삭제하시겠습니까?"))try{await c.delete(e),n(i.filter(t=>t.id!==e))}catch(t){alert("할 일 삭제에 실패했습니다.")}})(e.id),className:"text-gray-400 hover:text-red-500",children:"×"})]}),t.jsxs("div",{className:"pl-9 space-y-1",children:[t.jsxs("p",{className:"text-sm text-gray-400",children:["등록: ",f(e.createdAt)]}),e.completedAt&&t.jsxs("p",{className:"text-sm text-gray-400",children:["완료: ",f(e.completedAt)]})]})]},e.id))}),(!i.length||d&&!i.some(e=>e.portfolioId===d))&&t.jsx("div",{className:"text-center py-8",children:t.jsx("p",{className:"text-gray-400",children:"아직 할 일이 없습니다."})})]})})};export{r as TodoPage};
//# sourceMappingURL=TodoPage-3eba0b65.js.map
