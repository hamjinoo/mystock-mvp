import{r as e,j as t,e as a}from"./react-265ec861.js";import{d as s,L as o}from"./index-65335e1b.js";import{P as l}from"./portfolioService-3819a654.js";import"./vendor-936e0d4d.js";import"./dexie-e331f4d1.js";import"./router-a48e489e.js";class r{static async getAll(){return s.todos.toArray()}static async getByPortfolioId(e){return s.todos.where("portfolioId").equals(e).toArray()}static async create(e){const t=await s.todos.add(e),a=await s.todos.get(t);if(!a)throw new Error("할 일 생성에 실패했습니다.");return a}static async update(e,t){await s.todos.update(e,t);const a=await s.todos.get(e);if(!a)throw new Error("할 일 업데이트에 실패했습니다.");return a}static async delete(e){await s.todos.delete(e)}static async toggleDone(e){const t=await this.getById(e);if(!t)throw new Error("Todo not found");const a={...t,completed:!t.completed,done:!t.completed,completedAt:t.completed?null:Date.now()};await this.update(e,a)}static async getById(e){return await s.todos.get(e)}}const c=()=>{const[s,c]=e.useState([]),[i,n]=e.useState([]),[d,m]=e.useState(null),[u,p]=e.useState(""),[x,h]=e.useState(!0);e.useEffect((()=>{y()}),[]);const y=async()=>{try{const[e,t]=await Promise.all([l.getAll(),r.getAll()]);c(e),n(t)}catch(e){}finally{h(!1)}},g=e=>new Intl.DateTimeFormat("ko-KR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(new Date(e));return x?t.jsx("div",{className:"container mx-auto px-4 py-8",children:t.jsx("div",{className:"flex justify-center items-center h-64",children:t.jsx(o,{})})}):t.jsx("div",{className:"container mx-auto px-4 py-8",children:t.jsxs("div",{className:"max-w-2xl mx-auto",children:[t.jsx("h1",{className:"text-2xl font-bold mb-8",children:"할 일 목록"}),t.jsxs("div",{className:"mb-6",children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"포트폴리오"}),t.jsxs("select",{value:d||"",onChange:e=>m(e.target.value?Number(e.target.value):null),className:"w-full px-4 py-2 bg-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"",children:"포트폴리오 선택"}),s.map((e=>t.jsx("option",{value:e.id,children:e.name},e.id)))]})]}),t.jsx("form",{onSubmit:async e=>{if(e.preventDefault(),u.trim()&&d)try{const e=await r.create({portfolioId:d,text:u.trim(),completed:!1,createdAt:Date.now(),completedAt:null});n([...i,e]),p("")}catch(t){alert("할 일 추가에 실패했습니다.")}},className:"mb-8",children:t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"text",value:u,onChange:e=>p(e.target.value),className:"flex-1 px-4 py-2 bg-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"새 할 일 추가",disabled:!d}),t.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed",disabled:!d||!u.trim(),children:t.jsx(a,{className:"h-5 w-5"})})]})}),t.jsx("div",{className:"space-y-4",children:i.filter((e=>!d||e.portfolioId===d)).sort(((e,t)=>t.createdAt-e.createdAt)).map((e=>t.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("input",{type:"checkbox",checked:e.completed,onChange:()=>(async e=>{try{const t=await r.update(e.id,{...e,completed:!e.completed,completedAt:e.completed?null:Date.now()});n(i.map((a=>a.id===e.id?t:a)))}catch(t){alert("할 일 상태 변경에 실패했습니다.")}})(e),className:"h-5 w-5 rounded border-gray-600 text-blue-500 focus:ring-blue-500 focus:ring-offset-gray-800"}),t.jsx("span",{className:e.completed?"line-through text-gray-400":"",children:e.text})]}),t.jsx("button",{onClick:()=>(async e=>{if(window.confirm("이 할 일을 삭제하시겠습니까?"))try{await r.delete(e),n(i.filter((t=>t.id!==e)))}catch(t){alert("할 일 삭제에 실패했습니다.")}})(e.id),className:"text-gray-400 hover:text-red-500",children:"×"})]}),t.jsxs("div",{className:"pl-9 space-y-1",children:[t.jsxs("p",{className:"text-sm text-gray-400",children:["등록: ",g(e.createdAt)]}),e.completedAt&&t.jsxs("p",{className:"text-sm text-gray-400",children:["완료: ",g(e.completedAt)]})]})]},e.id)))}),(!i.length||d&&!i.some((e=>e.portfolioId===d)))&&t.jsx("div",{className:"text-center py-8",children:t.jsx("p",{className:"text-gray-400",children:"아직 할 일이 없습니다."})})]})})};export{c as TodoPage};
//# sourceMappingURL=TodoPage-fd4c7450.js.map
