# 문제 해결 가이드

## 데이터베이스 관련 문제

### 1. 포트폴리오 그룹 제거 후 발생한 문제들

#### 문제 상황
1. 새 종목 추가 시 포트폴리오가 있음에도 없다고 표시됨
2. 종목 추가 후 계좌 상세 페이지에서 종목 리스트 및 자산, 수익률이 표시되지 않음

#### 원인
1. `AccountService.getWithPortfolios`에서 포트폴리오 정보가 제대로 로드되지 않음
2. `AccountService.getAccountSummary`에서 포지션 정보를 가져올 때 계층 구조가 잘못됨

#### 해결 방법
1. `AccountService.getWithPortfolios` 수정:
   - 포트폴리오와 포지션 정보를 함께 로드하도록 변경
   - 각 포트폴리오의 포지션도 함께 로드하여 반환

2. `AccountService.getAccountSummary` 수정:
   - 계좌에 속한 모든 포트폴리오를 먼저 가져옴
   - 각 포트폴리오의 포지션을 가져와서 포트폴리오 정보와 함께 반환

### 2. 타입 관련 문제

#### 문제 상황
1. `PortfolioCategory` enum을 문자열 리터럴 타입으로 변경 후 발생한 타입 오류들
2. `NewAccount` 타입과 `Account` 타입 간의 호환성 문제

#### 해결 방법
1. `PortfolioCategory` 관련:
   - 모든 enum 사용을 문자열 리터럴로 변경
   - 관련 컴포넌트들의 타입 정의 수정
   - 기본값 설정 시 문자열 리터럴 사용

2. Account 타입 관련:
   - `NewAccount` 타입을 `Omit<Account, 'id'>` 로 수정
   - DB 레이어에서 타입 변환 처리

## 권장 사항

1. 데이터 구조 변경 시:
   - 변경 전 영향도 분석 수행
   - 관련된 모든 컴포넌트 확인
   - 단계적 변경 및 테스트

2. 타입 시스템 활용:
   - 명시적인 타입 정의
   - 유틸리티 타입 활용 (`Omit`, `Pick` 등)
   - 타입 가드 사용

3. 데이터 로딩:
   - 계층 구조를 고려한 데이터 로딩
   - 필요한 관계 데이터 함께 로드
   - 성능을 고려한 쿼리 최적화

## 향후 개선 사항

1. 데이터 정합성 검증 강화:
   - 저장 전 데이터 유효성 검사
   - 관계 데이터 존재 여부 확인
   - 오류 발생 시 롤백 처리

2. 에러 처리 개선:
   - 구체적인 에러 메시지
   - 사용자 친화적인 에러 표시
   - 로깅 강화

3. 성능 최적화:
   - 불필요한 데이터 로딩 최소화
   - 캐싱 전략 수립
   - 페이지네이션 적용 